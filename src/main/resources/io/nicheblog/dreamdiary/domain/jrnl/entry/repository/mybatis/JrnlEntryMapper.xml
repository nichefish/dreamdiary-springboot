<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.nicheblog.dreamdiary.domain.jrnl.entry.repository.mybatis.JrnlEntryMapper">

    <resultMap id="JrnlEntryMap" type="io.nicheblog.dreamdiary.domain.jrnl.entry.model.JrnlEntryDto">
        <id property="postNo" column="post_no"/>
        <result property="jrnlDayNo" column="jrnl_day_no"/>
        <result property="idx" column="idx"/>
        <result property="yy" column="yy"/>
        <result property="mnth" column="mnth"/>
    </resultMap>

    <!-- 삭제 데이터 조회 -->
    <select id="getDeletedByPostNo" resultMap="JrnlEntryMap">
        /* JrnlEntryMapper.getDeletedByPostNo */
        SELECT
            entry.post_no AS postNo,
            entry.jrnl_day_no AS jrnlDayNo,
            entry.idx,
            day.yy AS yy,
            day.mnth AS mnth
        FROM jrnl_entry entry
        LEFT JOIN jrnl_day day
            ON entry.jrnl_day_no = day.post_no
        WHERE entry.post_no = #{postNo}
    </select>

    <!-- 인덱스 갱신을 위한 전체 객체 조회 -->
    <select id="findAllForReorder" resultMap="JrnlEntryMap">
        /* JrnlEntryMapper.findAllForReorder */
        SELECT *
        FROM jrnl_entry
        WHERE jrnl_day_no = #{jrnlDayNo} AND del_yn = 'N'
        ORDER BY idx
    </select>

    <!-- 인덱스 갱신 -->
    <update id="batchUpdateIdx">
        /* JrnlEntryMapper.batchUpdateIdx */
        <foreach collection="list" item="item" separator=";">
            UPDATE jrnl_entry
            SET idx = #{item.idx}
            WHERE post_no = #{item.postNo}
        </foreach>
    </update>
</mapper>