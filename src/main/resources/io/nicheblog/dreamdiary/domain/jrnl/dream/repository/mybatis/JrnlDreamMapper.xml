<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.nicheblog.dreamdiary.domain.jrnl.dream.repository.mybatis.JrnlDreamMapper">

    <resultMap id="JrnlDreamMap" type="io.nicheblog.dreamdiary.domain.jrnl.dream.model.JrnlDreamDto">
        <id property="postNo" column="post_no"/>
        <result property="jrnlDayNo" column="jrnl_day_no"/>
        <result property="idx" column="idx"/>
        <result property="yy" column="yy"/>
        <result property="mnth" column="mnth"/>
    </resultMap>

    <!-- 삭제 데이터 조회 -->
    <select id="getDeletedByPostNo" resultMap="JrnlDreamMap">
        /* JrnlDreamMapper.getDeletedByPostNo */
        SELECT
            dream.post_no AS postNo,
            dream.jrnl_day_no AS jrnlDayNo,
            dream.idx,
            day.yy AS yy,
            day.mnth AS mnth
        FROM jrnl_dream dream
        LEFT JOIN jrnl_day day
            ON dream.jrnl_day_no = day.post_no
        WHERE dream.post_no = #{postNo}
    </select>

    <!-- 인덱스 갱신을 위한 전체 객체 조회 -->
    <select id="findAllForReorder" resultMap="JrnlDreamMap">
        /* JrnlDreamMapper.findAllForReorder */
        SELECT *
        FROM jrnl_dream
        WHERE jrnl_day_no = #{jrnlDayNo} AND del_yn = 'N'
        ORDER BY idx
    </select>

    <!-- 인덱스 갱신 -->
    <update id="batchUpdateIdx">
        /* JrnlDreamMapper.batchUpdateIdx */
        <foreach collection="list" item="item" separator=";">
            UPDATE jrnl_dream
            SET idx = #{item.idx}
            WHERE post_no = #{item.postNo} AND del_yn = 'N'
        </foreach>
    </update>
</mapper>